<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 30px; }
    img { max-width: 90%; border-radius: 8px; margin-top: 20px; }
    .error { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ğŸ“¥ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</h1>
  <div id="content">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const txId = urlParams.get("tx_id");
    const contentDiv = document.getElementById("content");

    async function fetchImage() {
      const res = await fetch(`/download/${txId}`);
      if (res.status === 200) {
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        contentDiv.innerHTML = `
          <img src="${url}" alt="Generated Image">
          <br><a href="${url}" download="image.jpg">
            <button style="margin-top: 20px; font-size: 18px;">ì´ë¯¸ì§€ ì €ì¥</button>
          </a>
        `;
      } else if (res.status === 403) {
        contentDiv.innerHTML = `<p class="error">âš ï¸ ì´ë¯¸ ë‹¤ìš´ë¡œë“œëœ íŠ¸ëœì­ì…˜ì…ë‹ˆë‹¤.</p>`;
      } else if (res.status === 404) {
        contentDiv.innerHTML = `<p class="error">â³ ì•„ì§ ì´ë¯¸ì§€ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>`;
        setTimeout(fetchImage, 5000);
      } else {
        contentDiv.innerHTML = `<p class="error">âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤ (${res.status})</p>`;
      }
    }

    if (txId) fetchImage();
    else contentDiv.innerHTML = `<p class="error">tx_id íŒŒë¼ë¯¸í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
  </script>
</body>
</html>
